CinePi5: Unified Production Installer & Camera Stack (v5.1.0-prod)The Definitive Deployment Solution for Raspberry Pi 5 Cinema Camera SystemsOverviewCinePi5 is a comprehensive, production-grade software and deployment stack that transforms a bare-metal Raspberry Pi 5 into a robust and remotely manageable cinema camera appliance. Engineered for enterprise and SaaS-grade delivery, CinePi5 offers unparalleled robustness, security, and advanced features for professional video production workflows.This repository contains the unified installer script (cinepi5_installer.sh) and the core CinePi5 camera application (cinepi5_gpu.py), along with supporting kernel modules and documentation.Key FeaturesCinePi5 provides a complete ecosystem for a professional camera system:High-Performance Video Capture:GPU-accelerated video preview and recording leveraging Raspberry Pi 5's VideoCore VII (V3D).Zero-copy ISP to V3D integration for optimal performance.Real-time 3D LUT (Look-Up Table) application in the fragment shader for cinematic color grading.Efficient H.264 video encoding.Robust Deployment & Management:Unified Installer (cinepi5_installer.sh): A single script to fully provision a Raspberry Pi 5, handling all OS dependencies, Python environments, application deployment, and system configurations.Automated Self-Update: The installer can update itself to the latest version directly from GitHub before execution.Automated Over-The-Air (OTA) Updates: Regularly checks for and applies application and system updates from GitHub Releases, ensuring your fleet is always current.Advanced Backup & Recovery: Incremental backup system with configurable local storage and optional remote backup (SFTP implemented, extensible to S3/Minio). Includes robust rollback capabilities.Comprehensive CLI (sudo cinepi5): A powerful command-line interface for status checks, recording control, camera settings, backup, update, rollback, and system shutdown.Systemd Integration: Hardened systemd services for the main application, backups, OTA, and health reporting, ensuring reliable operation and automatic restarts.Cloud Integration for Production Workflows:Automated Footage Upload: Seamlessly uploads recorded video and audio files to AWS S3 using presigned URLs obtained from your cloud API.Metadata Synchronization: Sends rich shoot metadata (camera settings, take number, timestamp, etc.) alongside uploads to your cloud API for asset tracking and post-production.Cloud-Side Action Triggering: Designed to trigger cloud-based actions (e.g., notifications, job status updates, transcoding) upon successful upload and metadata submission.(Optional) Job Status Query: Ability to query cloud-side job processing status for real-time feedback.Security & Monitoring:Secure-by-Default API: Web API binds to localhost (127.0.0.1) by default, with an option for 0.0.0.0 (requires strong API token security).Token-Based API Authentication: All critical API endpoints require a Bearer token for secure control.UFW Firewall Configuration: Automatically sets up a secure firewall, allowing only necessary ports (SSH, Web UI, Heartbeat, Prometheus).System Health Reporting: Optional, configurable "phone home" feature to send periodic system metrics to a webhook for fleet monitoring.Prometheus Node Exporter: Integrated for comprehensive system-level metric collection.Robust Logging: Detailed logging for all installer operations and application activity.Hardware & System Integration:Custom Kernel Module Support: Integrates custom kernel modules (e.g., gpio_tally) via DKMS, ensuring compatibility across kernel updates.Hardware Detection: Pre-flight checks for camera module and external storage presence.User & Permissions Management: Creates a dedicated system user (cinepi) with appropriate permissions for secure operation.First-Boot Onboarding: Displays network information, Web UI URL, and API token via a temporary web page and /boot files for easy initial setup.Hardware RequirementsRaspberry Pi 5: This installer and application are specifically designed for the Raspberry Pi 5.Raspberry Pi Camera Module: A compatible camera module (e.g., Camera Module 3, HQ Camera) connected via the MIPI CSI interface.Storage:A high-quality microSD card (32GB+ recommended) or NVMe SSD for the operating system.Dedicated external storage (SSD/HDD via USB 3.0 recommended) for media recording (/media/cinepi). The installer will detect and warn if external storage is not found, defaulting to the internal SD card.Software Requirements (Base OS)Raspberry Pi OS (64-bit): A fresh installation of the latest Raspberry Pi OS (formerly Raspbian), 64-bit version.Raspberry Pi OS Lite (64-bit): Recommended for headless (no monitor/keyboard) deployments.Raspberry Pi OS Desktop (64-bit): Suitable if you intend to use a monitor and keyboard directly with the Pi.Internet Connectivity: Required during installation for package downloads and GitHub access.Installation GuideFollow these steps to deploy CinePi5 on your Raspberry Pi 5.Step 1: Prepare Your GitHub RepositoryThe installer pulls the CinePi5 application code and kernel module sources directly from your GitHub repository.Fork/Clone this Repository: If you haven't already, fork or clone the therealstablegenius/cinepi5 repository to your local development environment.git clone https://github.com/therealstablegenius/cinepi5.git
cd cinepi5
Update cinepi5_installer.sh:Open cinepi5_installer.sh in a text editor.Crucially, ensure the REPO_OWNER, REPO_NAME, and REPO_BRANCH variables near the top of the script (around line 20-25) are set to your actual GitHub username/organization and repository name.# Example:
REPO_OWNER="your_github_username_or_org"
REPO_NAME="your_cinepi5_repo_name"
REPO_BRANCH="main" # Or your default branch name (e.g., 'master')
Add Core Application Files:Ensure your cinepi5_gpu.py and the luts/ directory (containing cinepi_film_look.cube) are committed and pushed to the main branch of your repository.Add Custom Kernel Module Sources:Create a kmods/ directory at the root of your repository.Inside kmods/, create a subdirectory for each kernel module (e.g., kmods/gpio_tally/).Place the .c source file (e.g., gpio_tally.c), a Makefile, and a dkms.conf file for each module in its respective directory.Example Structure:cinepi5/
├── cinepi5_gpu.py
├── luts/
│   └── cinepi_film_look.cube
├── kmods/
│   └── gpio_tally/
│       ├── gpio_tally.c
│       ├── dkms.conf
│       └── Makefile
├── Documentation/
│   └── devicetree/
│       └── bindings/
│           └── leds/
│               └── cinesoft,gpio-tally.yaml
└── cinepi5_installer.sh
# ... other files like README.md, Cinipi5ultimate.txt
Create GitHub Release for OTA Updates:For the OTA update feature to work, you need to create a GitHub Release.Build cinepi5_pkg.tar.gz: Create a gzipped tarball of your entire /opt/cinepi5 application directory (excluding venv and ota).Generate checksums.sha256: Calculate the SHA256 sum of cinepi5_pkg.tar.gz.Create Release: On your GitHub repository, go to "Releases" -> "Draft a new release".Attach Assets: Upload cinepi5_pkg.tar.gz and checksums.sha256 (and optionally post_update.sh) as binary assets to this release. Use a tag like v5.1.0.Commit and Push all changes to your GitHub repository.Step 2: Prepare Your Raspberry PiInstall Raspberry Pi OS: Flash the latest Raspberry Pi OS (64-bit) onto your SD card/NVMe.Network & SSH: Ensure your Pi has internet access. If headless, enable SSH.Transfer Installer: Copy your modified cinepi5_installer.sh to your Pi (e.g., to /home/pi/).# Example using curl (replace with your raw GitHub URL to the installer)
curl -fsSL https://raw.githubusercontent.com/your_github_username_or_org/your_cinepi5_repo_name/main/cinepi5_installer.sh -o cinepi5_installer.sh
Step 3: Run the CinePi5 InstallerMake Executable:chmod +x cinepi5_installer.sh
Run Installation:sudo ./cinepi5_installer.sh --install
For a GUI-guided installation (if zenity is available and you're in a desktop environment), simply run: sudo ./cinepi5_installer.shThe installer will output progress to your terminal and to /var/log/cinepi5/installer.log.Step 4: Post-Installation & First BootReboot:sudo reboot
This is highly recommended to ensure all kernel modules and systemd services are properly initialized.Check Status: After reboot, verify the CinePi5 service:sudo systemctl status cinepi5
It should show active (running).Access Onboarding Info:A file /boot/cinepi5_network_info.txt will contain your Pi's IP, Web UI URL, and API token.A QR code for the Web UI might be generated at /boot/cinepi5_web_qr.png.UsageCommand Line Interface (CLI)The installer deploys a powerful CLI wrapper at /usr/local/bin/cinepi5.sudo cinepi5 help
Common Commands:sudo cinepi5 status: Get detailed system and camera status.sudo cinepi5 record: Start recording video.sudo cinepi5 stop-record: Stop recording video.sudo cinepi5 iso <value>: Set camera ISO (e.g., sudo cinepi5 iso 800).sudo cinepi5 shutter <us>: Set shutter speed in microseconds (e.g., sudo cinepi5 shutter 12500).sudo cinepi5 awb <mode>: Set AWB mode (e.g., sudo cinepi5 awb daylight).sudo cinepi5 backup: Trigger a manual system backup.sudo cinepi5 update: Check for and apply OTA updates.sudo cinepi5 rollback: Rollback to the last pre-update state.sudo cinepi5 repair: Repair permissions and log directories.sudo cinepi5 shutdown: Safely shut down the system.sudo cinepi5 logs: Tail the main application log.sudo cinepi5 installer-logs: Tail the installer log.Web User Interface (Web UI)Access the CinePi5 Web UI through your browser at http://<YOUR_PI_IP_ADDRESS>:8080 (or your configured HTTP_PORT). This interface provides a live preview and controls for recording and camera settings.API AccessThe CinePi5 application exposes a Flask API for programmatic control.Base URL: http://<YOUR_PI_IP_ADDRESS>:<HTTP_PORT>Authentication: Most endpoints require a Bearer token in the Authorization header. The token is found in /etc/cinepi5/api_token and in the first-boot info.Status Endpoint (Unauthenticated): GET /status provides system health and camera status without a token for easy monitoring.Configuration (/etc/cinepi5/deployment.conf)The installer provides sane defaults, but for production deployments, you should customize /etc/cinepi5/deployment.conf. This YAML file allows you to override global variables defined in the installer.Key Configuration Options:WEB_HOST: Set to 0.0.0.0 for remote Web UI access (default is 127.0.0.1 for local-only).HTTP_PORT, SSH_PORT, UDP_PORT, NODE_EXPORTER_PORT: Customize network ports.MAX_FULL_BACKUPS, RETENTION_DAYS: Adjust backup policy.REMOTE_BACKUP_ENABLED, REMOTE_BACKUP_TYPE, REMOTE_BACKUP_HOST, REMOTE_BACKUP_USER, REMOTE_BACKUP_PATH, REMOTE_BACKUP_KEY_PATH: Configure remote backups.HEALTH_REPORTING_ENABLED, HEALTH_REPORTING_URL, HEALTH_REPORTING_INTERVAL_MIN: Enable and configure periodic health reporting.CLOUD_INTEGRATION_ENABLED: Set to true to enable automated cloud uploads.CLOUD_API_URL: Your cloud API endpoint (e.g., https://your-cloud-api.example.com).CLOUD_API_TOKEN_FILE: Path to the file containing the API token for your cloud backend.After modifying deployment.conf, you must restart the CinePi5 service for changes to take effect:sudo systemctl restart cinepi5
Cloud IntegrationThe CinePi5 stack is built for seamless integration with your cloud backend, enabling automated footage upload and metadata synchronization.How it Works:Presigned URL Request: After a recording stops, cinepi5_gpu.py requests a presigned S3 upload URL from your configured CLOUD_API_URL.Direct S3 Upload: The CinePi5 device uploads the video/audio file directly to S3 using the presigned URL.Metadata Post: Simultaneously, it sends detailed shoot metadata (camera ID, settings, timestamp, etc.) to your cloud API.Cloud-Side Processing: Your cloud API (e.g., a Flask/FastAPI app) handles:Generating presigned URLs.Receiving and storing metadata (e.g., in a database like RDS/DynamoDB).Triggering downstream actions (e.g., transcoding, notifications, indexing) based on the uploaded footage and metadata.Your Cloud Backend (Example)You will need to deploy a cloud API that exposes endpoints like these:POST /get_upload_url: Receives filename and returns a presigned S3 URL.POST /post_metadata: Receives JSON metadata and processes it.GET /job_status/<job_id>: (Optional) Returns the processing state of a cloud job.Custom Kernel ModulesCinePi5 supports custom kernel modules via DKMS (Dynamic Kernel Module Support), ensuring they are automatically rebuilt and installed when your Raspberry Pi's kernel updates.Adding Modules: Place your kernel module source code (e.g., your_module.c), a Makefile, and a dkms.conf file in a dedicated subdirectory under kmods/ in your GitHub repository (e.g., kmods/your_module/).DKMS Integration: The installer will automatically discover, build, and install these modules during deployment.Backup & RecoveryCinePi5 includes a robust backup system:Daily Backups: A systemd timer schedules daily incremental backups of critical system configurations and application files.Local Storage: Backups are stored in $MEDIA_DIR/backups.Remote Backup (Optional): Configurable to push backups to a remote SFTP server (extensible to S3/Minio).Rollback: The sudo cinepi5 rollback command allows you to revert the system to the state of the last successful update.Over-The-Air (OTA) UpdatesThe OTA system ensures your CinePi5 fleet stays up-to-date:Hourly Checks: A systemd timer periodically checks your GitHub repository for new releases.Secure Downloads: Downloads update packages and verifies checksums before applying.Fail-Safe Rollback: Automatically creates a rollback snapshot before applying updates, allowing for recovery in case of failure.Manual Trigger: sudo cinepi5 update can be used to initiate an update check manually.Health MonitoringLocal Status API: The /status endpoint on the Web UI port provides real-time system metrics (CPU, memory, disk, camera status, app version, recent errors).Prometheus Integration: Prometheus Node Exporter runs on port 9100, exposing system-level metrics for external monitoring solutions.Health Reporting (Optional): Configurable to send periodic JSON reports of system health to a designated webhook URL for centralized fleet management.TroubleshootingInstaller Logs: Check /var/log/cinepi5/installer.log for details on installation failures.Application Logs: Check /var/log/cinepi5/cinepi5_app.log for application runtime errors.Systemd Journals: Use journalctl -u cinepi5 or journalctl -u cinepi5-backup (etc.) for service-specific logs.Repair Utility: If permissions or log directories get corrupted, run sudo cinepi5 repair.Camera Issues: Ensure the camera module is correctly seated and enabled in raspi-config. Check vcgencmd get_camera.Network Issues: Verify IP address (hostname -I), firewall rules (sudo ufw status), and network connectivity.ContributingWe welcome contributions to the CinePi5 project! Please refer to the CONTRIBUTING.md file (if available) in this repository for guidelines on how to submit bug reports, feature requests, or pull requests.LicenseThis project is licensed under the MIT License. See the LICENSE file for details.Contact & SupportFor professional inquiries, support, or custom development, please contact:Howard Steven Rice First World Improvements Corporation support@firstworldimprovements.com (Example email)https://www.firstworldimprovements.com (Example website)Repository URL: https://github.com/therealstablegenius/cinepi5Version: 5.1.0-prod
